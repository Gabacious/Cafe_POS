<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kapihan ni Boss G POS - Order System (Pesos)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; } /* Lighter overall background */
        .bg-cafe { background-color: #5d4037 !important; } /* Darker, richer coffee color for the navbar */
        .menu-item { 
            cursor: pointer; 
            transition: transform 0.2s, box-shadow 0.2s; 
            border: 1px solid #e0e0e0; 
            background-color: white;
            border-radius: 8px; /* Slightly rounded corners */
        }
        .menu-item:hover { transform: scale(1.03); box-shadow: 0 8px 16px rgba(0,0,0,0.2) !important; } /* Stronger hover effect */
        .product-image { 
            width: 100%; 
            height: 120px; 
            object-fit: cover; 
            border-top-left-radius: 8px; 
            border-top-right-radius: 8px; 
        }
        
        /* Styles for the new Options Panel */
        .options-panel-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1050; /* Above Bootstrap card/navbar */
        }
        .options-panel-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        /* Styles for printing the receipt */
        @media print {
            body * { visibility: hidden; }
            #receipt-modal-content, #receipt-modal-content * { visibility: visible; }
            #receipt-modal-content { position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-cafe shadow-sm">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">☕ Kapihan ni Boss G POS (<span id="userRoleDisplay">Guest</span>)</a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="navLinks">
                    </ul>
                <div class="d-flex">
                    <a href="login.html" class="btn btn-outline-light" onclick="localStorage.clear()">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-lg-8">
                <h3 class="mb-4 text-secondary">Menu Selection</h3>
                
                <div class="mb-4 row align-items-center bg-white p-3 shadow-sm rounded">
                    <label for="categoryFilter" class="col-auto col-form-label fw-bold text-dark">Filter by Category:</label>
                    <div class="col-md-4 col-lg-3">
                        <select id="categoryFilter" class="form-select" onchange="filterMenu()">
                            <option value="All">All Categories</option>
                            <option value="Coffee">Coffee</option>
                            <option value="Tea">Tea</option>
                            <option value="Juice">Juice</option>
                            <option value="Pastry">Pastry</option>
                            <option value="Meal">Meal</option>
                        </select>
                    </div>
                </div>

                <div class="row" id="menu-container">
                    </div>
            </div>

            <div class="col-lg-4">
                <div class="card shadow-lg sticky-top" style="top: 20px;">
                    <div class="card-header bg-primary text-white"><h5>Current Order</h5></div>
                    <div class="card-body">
                        <div class="mb-3 p-3 bg-light rounded border border-warning">
                            <label class="form-label fw-bold text-danger">Apply Discount (Admin Access Required):</label>
                            
                            <div class="form-check">
                                <input class="form-check-input discount-radio" type="radio" name="discountRadio" id="noDiscount" value="0" checked onchange="updateUI()">
                                <label class="form-check-label" for="noDiscount">No Discount</label>
                            </div>
                            
                            <div class="form-check">
                                <input class="form-check-input discount-radio" type="radio" name="discountRadio" id="scPwdDiscount" value="0.20" onchange="updateUI()" disabled>
                                <label class="form-check-label text-danger" for="scPwdDiscount">20% Senior Citizen / PWD</label>
                            </div>

                            <div class="form-check">
                                <input class="form-check-input discount-radio" type="radio" name="discountRadio" id="promoDiscount" value="0.10" onchange="updateUI()" disabled>
                                <label class="form-check-label text-success" for="promoDiscount">10% Standard Promo</label>
                            </div>
                            
                            <div id="adminOverrideContainer" class="mt-3 pt-3 border-top d-none">
                                <button id="adminOverrideBtn" class="btn btn-sm btn-warning w-100" onclick="requestAdminOverride()">Request Admin Override</button>
                            </div>
                            
                        </div>

                        <ul id="cart-list" class="list-group list-group-flush mb-3 border rounded">
                            <li class="list-group-item text-muted text-center py-4">Order is empty.</li>
                        </ul>
                        
                        <div class="d-flex justify-content-between p-1"><strong>Subtotal:</strong><span>₱<span id="subtotal-price">0.00</span></span></div>
                        <div class="d-flex justify-content-between mt-1 p-1 border-bottom"><strong>Applied Discount:</strong><span>₱<span id="discount-amount" class="text-danger">0.00</span></span></div>
                        <div class="d-flex justify-content-between fs-4 fw-bold text-primary mt-2 p-1"><strong>TOTAL:</strong><strong>₱<span id="total-price">0.00</span></strong></div>
                        
                        <button class="btn btn-success btn-lg w-100 mt-3" onclick="processPayment()">Process Payment</button>
                        <button class="btn btn-outline-secondary w-100 mt-2" onclick="clearOrder()">Clear Order</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="options-panel-overlay" class="options-panel-overlay">
        <div id="options-panel-content" class="options-panel-content">
            </div>
    </div>
    
    <script>
        // --- CONSTANTS AND INITIALIZATION ---
        
        // Size options for DRINKS (Coffee, Tea, Juice)
        const DRINK_SIZES = {
            'small': { displayName: 'Small (12 oz)', priceMultiplier: 0.8 }, 
            'medium': { displayName: 'Medium (16 oz)', priceMultiplier: 1.0 }, // Base Price
            'large': { displayName: 'Large (20 oz)', priceMultiplier: 1.2 } 
        };
        
        // Size options for FOOD (Meals)
        const FOOD_SIZES = {
            'single': { displayName: 'Single', priceMultiplier: 1.0 }, // Base Price
            'share': { displayName: 'To Share', priceMultiplier: 1.8 } // 80% increase
        };

        const menuItems = [
            // Coffee Category 
            { id: 1, name: 'Latte', category: 'Coffee', price: 150.00, isDrink: true, needsTemp: true, needsFoodSize: false, image: 'https://images.immediate.co.uk/production/volatile/sites/30/2020/08/iced-latte-30188f7.jpg?quality=90&webp=true&resize=440,400' },
            { id: 3, name: 'Espresso', category: 'Coffee', price: 120.00, isDrink: true, needsTemp: true, needsFoodSize: false, image: 'https://www.wyseguide.com/wp-content/uploads/2025/07/Shaken-Espresso-011-600x600.jpg' },
            { id: 5, name: 'Americano', category: 'Coffee', price: 130.00, isDrink: true, needsTemp: true, needsFoodSize: false, image: 'https://assets.beanbox.com/blog_images/AB7ud4YSE6nmOX0iGlgA.jpeg' },
            { id: 7, name: 'Hot Chocolate', category: 'Coffee', price: 140.00, isDrink: true, needsTemp: true, needsFoodSize: false, image: 'https://assets.epicurious.com/photos/61eb09dfb37c8d2963dd7bde/1:1/w_1280,c_limit/HotCocoaForOne_RECIPE_012022_086_VOG_final.jpg' },
            
            // Pastry Category - Name changed to Muffin
            { id: 2, name: 'Croissant', category: 'Pastry', price: 95.00, isDrink: false, needsTemp: false, needsFoodSize: false, image: 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Croissant-Petr_Kratochvil.jpg/960px-Croissant-Petr_Kratochvil.jpg' },
            { id: 6, name: 'Muffin', category: 'Pastry', price: 110.00, isDrink: false, needsTemp: false, needsFoodSize: false, image: 'https://hostessatheart.com/wp-content/uploads/2018/02/Basic-Homemade-Muffin-Recipe-2-682x1024.jpg' },
            
            // Tea Category 
            { id: 4, name: 'Regular Tea', category: 'Tea', price: 80.00, isDrink: true, needsTemp: true, needsFoodSize: false, image: 'https://sudachirecipes.com/wp-content/uploads/2025/03/royal-milk-tea-thumb-550x550.png' },
            
            // Juice Category 
            { id: 9, name: 'Fresh Orange Juice', category: 'Juice', price: 110.00, isDrink: true, needsTemp: false, needsFoodSize: false, image: 'https://cdn2.foodviva.com/static-content/food-images/juice-recipes/orange-pineapple-juice-recipe/orange-pineapple-juice-recipe.jpg' },
            
            // Meal Category - Name changed to Spaghetti. needsFoodSize: true
            { id: 8, name: 'Club Sandwich', category: 'Meal', price: 220.00, isDrink: false, needsTemp: false, needsFoodSize: true, image: 'https://ichef.bbci.co.uk/food/ic/food_16x9_1600/recipes/club_sandwich_16496_16x9.jpg' },
            { id: 10, name: 'Spaghetti', category: 'Meal', price: 280.00, isDrink: false, needsTemp: false, needsFoodSize: true, image: 'https://img.taste.com.au/WiSuiqrj/w643-h428-cfill-q90/taste/2024/03/5-ingredient-turbo-charged-spaghetti-recipe-196959-1-jpg-218232-1.jpg' }
        ];

        let cart = {};

        document.addEventListener('DOMContentLoaded', () => {
            checkAccessAndRenderNav();
            renderMenu(); // Renders all initially
            updateUI();
            
            // Allow clicking the overlay to close the panel
            document.getElementById('options-panel-overlay').addEventListener('click', function(event) {
                if (event.target.id === 'options-panel-overlay') {
                    hideOptionsPanel();
                }
            });
        });

        // --- MENU RENDERING AND OPTIONS PANEL LOGIC ---

        function filterMenu() {
            hideOptionsPanel(); // Close panel if menu changes
            const category = document.getElementById('categoryFilter').value;
            renderMenu(category);
        }

        function renderMenu(filterCategory = 'All') {
            const container = document.getElementById('menu-container');
            container.innerHTML = '';
            
            const filteredItems = filterCategory === 'All' 
                ? menuItems 
                : menuItems.filter(item => item.category === filterCategory);

            if (filteredItems.length === 0) {
                 container.innerHTML = '<div class="col-12"><p class="text-muted text-center py-5 border rounded bg-white">No items found in this category.</p></div>';
            } else {
                filteredItems.forEach(item => {
                    // Determine click handler: show options panel for drinks/meals, or add directly for others
                    const needsOptions = item.isDrink || item.needsFoodSize;
                    const clickHandler = needsOptions 
                        ? `addItemWithOptionsCheck(${item.id})` 
                        : `addToCart('${item.id}', '${item.name}', ${item.price})`;
                        
                    // Determine starting price display (use small for drinks, single for food, base price for pastries)
                    let startingPrice;
                    if (item.isDrink) {
                        startingPrice = 'Starting from ₱' + (item.price * DRINK_SIZES.small.priceMultiplier).toFixed(2);
                    } else if (item.needsFoodSize) {
                        startingPrice = 'Starting from ₱' + (item.price * FOOD_SIZES.single.priceMultiplier).toFixed(2);
                    } else {
                        startingPrice = '₱' + item.price.toFixed(2);
                    }
                        
                    const card = `
                        <div class="col-md-3 col-sm-6 mb-4">
                            <div class="card menu-item shadow-sm" onclick="${clickHandler}">
                                <img src="${item.image}" class="card-img-top product-image" alt="${item.name}">
                                <div class="card-body text-center p-2">
                                    <h6 class="card-title mb-0 fw-bold">${item.name}</h6>
                                    <p class="card-text text-primary mb-0">${startingPrice}</p>
                                    <small class="text-muted">${item.category}</small>
                                </div>
                            </div>
                        </div>
                    `;
                    container.innerHTML += card;
                });
            }
        }
        
        function addItemWithOptionsCheck(id) {
            const item = menuItems.find(i => i.id === id);
            if (!item) return;

            // Only render panel if options are needed (isDrink or needsFoodSize)
            if (item.isDrink || item.needsFoodSize) {
                renderOptionsPanel(item.id);
            } else {
                // Fallback for items without options (should be handled in renderMenu, but safe here)
                addToCart(item.id.toString(), item.name, item.price);
            }
        }

        function hideOptionsPanel() {
            document.getElementById('options-panel-overlay').style.display = 'none';
        }

        function renderOptionsPanel(id) {
            const item = menuItems.find(i => i.id === id);
            if (!item) return;

            const panelContent = document.getElementById('options-panel-content');
            
            // Determine the relevant size options, default selection, and label based on item type
            let sizeOptions = {};
            let defaultSizeKey = '';
            let sizeLabel = '';
            
            if (item.isDrink) {
                sizeOptions = DRINK_SIZES;
                defaultSizeKey = 'medium';
                sizeLabel = 'Size (Oz):';
            } else if (item.needsFoodSize) {
                sizeOptions = FOOD_SIZES;
                defaultSizeKey = 'single';
                sizeLabel = 'Portion:';
            } else {
                // Item does not require options, shouldn't be here.
                return;
            }
            
            let html = `
                <h4 class="mb-3">${item.name} Options</h4>
                <input type="hidden" id="selected-item-id" value="${item.id}">
                <input type="hidden" id="item-type-key" value="${item.isDrink ? 'drink' : 'food'}">
                
                <div class="mb-3 text-start">
                    <label for="size-select" class="form-label fw-bold">${sizeLabel}</label>
                    <select id="size-select" class="form-select mb-2" onchange="updatePanelPrice(${item.id})">
            `;
            
            // Size/Portion Dropdown options
            for (const sizeKey in sizeOptions) {
                const size = sizeOptions[sizeKey];
                const price = (item.price * size.priceMultiplier).toFixed(2);
                html += `<option value="${sizeKey}" data-price="${price}" ${sizeKey === defaultSizeKey ? 'selected' : ''}>
                    ${size.displayName} (₱${price})
                </option>`;
            }
            
            html += `
                    </select>
                </div>
            `;
            
            // Temperature Dropdown (only for Coffee/Tea)
            if (item.needsTemp) {
                html += `
                    <div class="mb-3 text-start">
                        <label for="temp-select" class="form-label fw-bold">Temperature:</label>
                        <select id="temp-select" class="form-select">
                            <option value="hot" selected>Hot</option>
                            <option value="iced">Iced</option>
                        </select>
                    </div>
                `;
            } else {
                 html += `<input type="hidden" id="temp-select" value="none">`;
            }

            // Current Total and Buttons
            const defaultPrice = (item.price * sizeOptions[defaultSizeKey].priceMultiplier).toFixed(2);
            html += `
                <div class="d-flex justify-content-between align-items-center mt-4 border-top pt-3">
                    <h5 class="mb-0">TOTAL: ₱<span id="panel-final-price">${defaultPrice}</span></h5>
                    <div>
                        <button class="btn btn-outline-danger me-2" onclick="hideOptionsPanel()">Cancel</button>
                        <button class="btn btn-primary" onclick="addToCartFromPanel(${item.id})">Add to Order</button>
                    </div>
                </div>
            `;

            panelContent.innerHTML = html;
            document.getElementById('options-panel-overlay').style.display = 'flex';
        }
        
        function updatePanelPrice(id) {
            const item = menuItems.find(i => i.id === id);
            if (!item) return;
            
            const sizeSelect = document.getElementById('size-select');
            const selectedOption = sizeSelect.options[sizeSelect.selectedIndex];
            
            const finalPrice = selectedOption.getAttribute('data-price');
            document.getElementById('panel-final-price').innerText = finalPrice;
        }


        function addToCartFromPanel(id) {
            const item = menuItems.find(i => i.id === id);
            if (!item) {
                hideOptionsPanel();
                return;
            }

            const sizeSelect = document.getElementById('size-select');
            const selectedSizeKey = sizeSelect.value;
            const finalPrice = parseFloat(document.getElementById('panel-final-price').innerText);
            
            // Determine which size list to use for display name
            const sizeList = item.isDrink ? DRINK_SIZES : FOOD_SIZES;
            const selectedSizeName = sizeList[selectedSizeKey].displayName;

            let tempKey = 'none';
            let tempName = '';

            if (item.needsTemp) {
                const tempSelect = document.getElementById('temp-select');
                tempKey = tempSelect.value;
                tempName = tempKey.charAt(0).toUpperCase() + tempKey.slice(1);
            }
            
            // Build the unique key and display name
            const cartKey = `${item.id}-${selectedSizeKey}-${tempKey}`;
            let displayName = `${item.name} (${selectedSizeName})`;
            if (item.needsTemp) {
                displayName += ` (${tempName})`;
            }

            // Add to cart and close panel
            addToCart(cartKey, displayName, finalPrice);
            hideOptionsPanel();
        }

        // --- CART LOGIC (Unchanged) ---
        
        function addToCart(cartKey, name, price) {
            // Price is already calculated by the panel logic or for non-drink items
            const finalPrice = parseFloat(price.toFixed(2));
            
            if (cart[cartKey]) {
                cart[cartKey].quantity += 1;
            } else {
                cart[cartKey] = { id: cartKey, name: name, price: finalPrice, quantity: 1 };
            }
            updateUI();
        }

        function removeFromCart(cartKey) {
            if (cart[cartKey] && cart[cartKey].quantity > 1) {
                cart[cartKey].quantity -= 1;
            } else {
                delete cart[cartKey];
            }
            updateUI();
        }

        function updateUI() {
            const list = document.getElementById('cart-list');
            list.innerHTML = '';
            let subtotal = 0;

            if (Object.keys(cart).length === 0) {
                 list.innerHTML = '<li class="list-group-item text-muted text-center py-4">Order is empty.</li>';
            } else {
                for (const cartKey in cart) {
                    const item = cart[cartKey];
                    const itemTotal = item.price * item.quantity;
                    subtotal += itemTotal;
                    
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center p-2';
                    li.innerHTML = `
                        <div>${item.name} (${item.quantity}x)<small class="text-muted d-block">₱${item.price.toFixed(2)} ea</small></div>
                        <div class="d-flex align-items-center">
                            <strong>₱${itemTotal.toFixed(2)}</strong>
                            <button class="btn btn-sm btn-danger ms-2 p-0 px-1" onclick="removeFromCart('${cartKey}')">-</button>
                        </div>
                    `;
                    list.appendChild(li);
                }
            }
            
            const selectedDiscountRadio = document.querySelector('input[name="discountRadio"]:checked');
            const discountRate = selectedDiscountRadio ? parseFloat(selectedDiscountRadio.value) : 0;
            
            const discount = subtotal * discountRate;
            const finalTotal = subtotal - discount;
            
            document.getElementById('subtotal-price').innerText = subtotal.toFixed(2);
            document.getElementById('discount-amount').innerText = discount.toFixed(2);
            document.getElementById('total-price').innerText = finalTotal.toFixed(2);
        }
        
        // --- AUTHENTICATION & NAVIGATION LOGIC (Modified to target new button location) ---

        function setDiscountControlsDisabled(isDisabled) {
            const radios = document.querySelectorAll('.discount-radio');
            radios.forEach(radio => {
                if (radio.id !== 'noDiscount') {
                    radio.disabled = isDisabled;
                }
            });

            if (isDisabled) {
                document.getElementById('noDiscount').checked = true;
                updateUI();
            }
        }

        function checkAccessAndRenderNav() {
            const userRole = localStorage.getItem('userRole');
            const tempAccess = localStorage.getItem('tempAdminAccess') === 'true';

            if (!userRole) {
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('userRoleDisplay').textContent = userRole + (tempAccess ? ' (Override Active)' : '');
            const navLinks = document.getElementById('navLinks');
            
            const hasDiscountAccess = userRole === 'Admin' || tempAccess;
            setDiscountControlsDisabled(!hasDiscountAccess);
            
            // Control Override Button visibility (NEW LOCATION TARGET)
            const overrideContainer = document.getElementById('adminOverrideContainer');
            if (userRole === 'Cashier' && !tempAccess) {
                overrideContainer.classList.remove('d-none');
            } else {
                overrideContainer.classList.add('d-none');
            }

            let links = '';
            if (userRole === 'Admin') { 
                links += `<li class="nav-item"><a class="nav-link" href="dashboard.html">Dashboard</a></li>`;
            }
            links += '<li class="nav-item"><a class="nav-link active" href="orders.html">Orders</a></li>';
            if (userRole === 'Admin') { 
                links += `
                    <li class="nav-item"><a class="nav-link" href="product_management.html">Products</a></li>
                    <li class="nav-item"><a class="nav-link" href="reports.html">Reports</a></li>
                `;
            }

            navLinks.innerHTML = links;
        }
        
        function requestAdminOverride() {
            const adminUsername = prompt("Enter Admin Username for Override:");
            const adminPassword = prompt("Enter Admin Password for Override:");
            
            if (adminUsername === 'admin' && adminPassword === 'adminpass') {
                localStorage.setItem('tempAdminAccess', 'true');
                alert("Admin override granted for this transaction. Discounts are now enabled. Admin links are restricted to permanent Admin role only.");
                checkAccessAndRenderNav();
            } else {
                alert("Invalid Admin credentials. Access denied.");
            }
        }

        function clearOrder() {
            cart = {};
            document.getElementById('noDiscount').checked = true;
            document.getElementById('categoryFilter').value = 'All';
            localStorage.removeItem('tempAdminAccess');
            checkAccessAndRenderNav();
            renderMenu();
            updateUI();
        }

        function processPayment() {
            if (Object.keys(cart).length === 0) {
                alert("Cannot process payment. The order is empty.");
                return;
            }
            
            const totalDisplay = document.getElementById('total-price').innerText;
            const paid = prompt(`Order Total: ₱${totalDisplay}. Enter customer payment amount in Pesos:`);
            
            if (paid !== null && !isNaN(parseFloat(paid))) {
                const total = parseFloat(totalDisplay);
                const paymentAmount = parseFloat(paid);
                
                if (paymentAmount >= total) {
                    const change = paymentAmount - total;
                    alert(`Payment successful! Change Due: ₱${change.toFixed(2)}`);
                    
                    printReceipt(total, paymentAmount, change);
                    
                    clearOrder(); 
                } else {
                    alert(`❌ Payment failed. Insufficient amount.`);
                }
            } else if (paid !== null) {
                alert("Invalid payment amount entered.");
            }
        }
        
        function printReceipt(total, paid, change) {
            const date = new Date().toLocaleString();
            const userRole = localStorage.getItem('userRole');
            
            let subtotal = 0;
            for (const id in cart) {
                subtotal += cart[id].price * cart[id].quantity;
            }
            
            const selectedDiscountRadio = document.querySelector('input[name="discountRadio"]:checked');
            const discountRate = selectedDiscountRadio ? parseFloat(selectedDiscountRadio.value) : 0;
            const discount = subtotal * discountRate;

            let discountLabel = (discountRate * 100).toFixed(0) + '%';
            if (discountRate === 0.20) discountLabel = "SC/PWD 20%";
            if (discountRate === 0.10) discountLabel = "Promo 10%";
            if (discountRate === 0) discountLabel = "None";


            let receiptContent = `
                <div style="width: 300px; padding: 10px; font-family: monospace; font-size: 12px; margin: 0 auto;">
                    <h4 style="text-align: center; margin-bottom: 5px;">KAPIHAN NI BOSS G RECEIPT</h4>
                    <div style="text-align: center; border-bottom: 1px dashed black; padding-bottom: 5px; margin-bottom: 10px;">
                        <p style="margin: 0;">Transaction Date: ${date}</p>
                        <p style="margin: 0;">Cashier: ${userRole}</p>
                    </div>
                    
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 10px;">
                        <thead>
                            <tr style="border-bottom: 1px dashed black;">
                                <th style="text-align: left;">ITEM</th>
                                <th style="text-align: right;">QTY</th>
                                <th style="text-align: right;">TOTAL (₱)</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            for (const id in cart) {
                const item = cart[id];
                const itemTotal = item.price * item.quantity;
                
                receiptContent += `
                            <tr>
                                <td style="text-align: left;">${item.name}</td>
                                <td style="text-align: right;">${item.quantity}</td>
                                <td style="text-align: right;">${itemTotal.toFixed(2)}</td>
                            </tr>
                `;
            }

            receiptContent += `
                        </tbody>
                    </table>
                    
                    <div style="border-top: 1px dashed black; padding-top: 5px;">
                        <p style="margin: 0; display: flex; justify-content: space-between;"><span>Subtotal:</span><span>₱${subtotal.toFixed(2)}</span></p>
                        <p style="margin: 0; display: flex; justify-content: space-between;"><span>Discount (${discountLabel}):</span><span>-₱${discount.toFixed(2)}</span></p>
                        <p style="margin: 0; display: flex; justify-content: space-between; font-weight: bold;"><span>TOTAL:</span><span>₱${total.toFixed(2)}</span></p>
                    </div>
                    
                    <div style="border-top: 1px dashed black; padding-top: 5px; margin-top: 10px;">
                        <p style="margin: 0; display: flex; justify-content: space-between;"><span>CASH PAID:</span><span>₱${paid.toFixed(2)}</span></p>
                        <p style="margin: 0; display: flex; justify-content: space-between; font-weight: bold;"><span>CHANGE:</span><span>₱${change.toFixed(2)}</span></p>
                    </div>
                    
                    <p style="text-align: center; margin-top: 15px;">** THANK YOU FOR YOUR ORDER! **</p>
                </div>
            `;
            
            const printWindow = window.open('', '', 'height=600,width=400');
            printWindow.document.write('<html><head><title>Receipt</title></head><body>');
            printWindow.document.write(receiptContent);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
        }
    </script>
</body>
</html>